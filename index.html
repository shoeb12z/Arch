<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Custodian - Architectural Portfolio</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Custom Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        // Using Google Fonts via CDN for display (Playfair) and body (Inter)
                        'display': ['"Playfair Display"', 'serif'],
                        'body': ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'charcoal': '#1F1F1F',
                        'ivory': '#F7F3E8',
                        'sandstone': '#DDB892',
                        'emerald': '#004D40',
                        'royal-blue': '#1A237E',
                        'gold-accent': '#FFD700',
                    },
                    boxShadow: {
                        'gold-xl': '0 10px 15px -3px rgba(255, 215, 0, 0.1), 0 4px 6px -2px rgba(255, 215, 0, 0.05)',
                    }
                }
            }
        }
    </script>
    <style>
        /* Import Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;600;700&display=swap');

        /* Custom Keyframes for Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeInUp {
            animation: fadeInUp 1s ease-out forwards;
        }
        .delay-300 { animation-delay: 0.3s; }
        .delay-500 { animation-delay: 0.5s; }
        .delay-800 { animation-delay: 0.8s; }

        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 180s linear infinite;
        }

        @keyframes pulse-slow {
            0%, 100% { opacity: 0.4; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }
        .animate-pulse-slow {
            animation: pulse-slow 8s infinite ease-in-out;
        }

        .scroll-reveal {
            transition: all 1000ms cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            transform: translateY(40px);
        }
        .scroll-reveal.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Utility for dynamic header background */
        .header-scrolled {
            background-color: rgba(31, 31, 31, 0.9); /* charcoal/90 */
            backdrop-filter: blur(8px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.5);
        }

        /* Custom CSS for the Roadmap Timeline Line */
        #animated-line {
            transition: height 0.7s cubic-bezier(0.4, 0, 0.2, 1); 
            opacity: 0;
        }
        .roadmap-step:nth-child(even) .roadmap-step-card {
            background-color: rgba(221, 184, 146, 0.1); /* sandstone/10 */
        }
        
    </style>
</head>
<body class="bg-charcoal font-body min-h-screen relative text-ivory">

    <!-- Looping Geometric Background (Stays on Charcoal sections) -->
    <div class="fixed inset-0 pointer-events-none z-0 overflow-hidden bg-charcoal">
        <svg class="absolute inset-0 w-full h-full opacity-[0.03] animate-spin-slow" viewBox="0 0 1000 1000">
            <defs>
                <pattern id="jaliPattern" patternUnits="userSpaceOnUse" width="100" height="100">
                    <path d="M 0 0 L 100 100 M 100 0 L 0 100" stroke="#DDB892" stroke-width="0.5" />
                    <circle cx="50" cy="50" r="10" fill="none" stroke="#DDB892" stroke-width="0.5" />
                </pattern>
            </defs>
            <rect width="100%" height="100%" fill="url(#jaliPattern)" transform="rotate(15 500 500)" />
        </svg>
        <div class="absolute inset-0 z-10 pointer-events-none opacity-[0.05] bg-[url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAGCAYAAADgpzT0AAAABmJLR0QA/wD/AP+gvaeTAAAAIklEQVQImWO0E0kEwMDAwJD/B2I0oGzAhQhQJcBEUAAANg0DBy7m/K8AAAAASUVORK5CYII=')]"></div>
    </div>

    <!-- Project Details Modal (Hidden by Default) -->
    <div id="project-modal" class="fixed inset-0 z-50 bg-charcoal/95 backdrop-blur-lg flex items-center justify-center p-4 opacity-0 pointer-events-none transition-opacity duration-500">
        <div id="modal-content" class="bg-ivory text-charcoal rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto transform scale-95 transition-transform duration-500">
            <!-- Content inserted by JS -->
        </div>
        <button id="close-modal-btn" class="absolute top-4 right-4 md:top-8 md:right-8 p-3 rounded-full bg-sandstone/80 text-charcoal hover:bg-sandstone transition z-50">
            <i data-lucide="x" class="w-6 h-6"></i>
        </button>
    </div>

    <!-- Header (Dynamic) -->
    <header id="main-header" class="fixed top-0 left-0 right-0 z-40 p-6 md:p-10 flex justify-between items-center text-ivory/90 transition-all duration-300 bg-transparent">
        <div class="text-2xl font-display font-bold tracking-widest text-sandstone">
            THE CUSTODIAN
        </div>
        <nav class="hidden md:flex space-x-8 text-sm uppercase tracking-wider font-body">
            <a href="#about" class="nav-link group relative hover:text-gold-accent transition duration-300">About<span class="absolute left-0 bottom-0 w-full h-[1px] bg-gold-accent transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left duration-300"></span></a>
            <a href="#projects" class="nav-link group relative hover:text-gold-accent transition duration-300">Projects<span class="absolute left-0 bottom-0 w-full h-[1px] bg-gold-accent transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left duration-300"></span></a>
            <a href="#roadmap" class="nav-link group relative hover:text-gold-accent transition duration-300">Roadmap<span class="absolute left-0 bottom-0 w-full h-[1px] bg-gold-accent transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left duration-300"></span></a>
            <a href="#contact" class="nav-link group relative hover:text-gold-accent transition duration-300">Contact<span class="absolute left-0 bottom-0 w-full h-[1px] bg-gold-accent transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left duration-300"></span></a>
        </nav>
        <button id="menu-toggle" class="md:hidden p-2 rounded-full border border-ivory/50 hover:bg-ivory/10 transition duration-300" aria-label="Toggle Menu">
            <svg id="menu-icon-open" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            <svg id="menu-icon-close" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
    </header>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="fixed inset-0 z-30 bg-charcoal/95 backdrop-blur-lg transform translate-x-full transition-transform duration-700 ease-in-out md:hidden">
        <div class="flex flex-col items-center justify-center h-full space-y-12 text-ivory font-display text-4xl">
            <a href="#about" class="mobile-nav-link hover:text-gold-accent transition duration-300">About</a>
            <a href="#projects" class="mobile-nav-link hover:text-gold-accent transition duration-300">Projects</a>
            <a href="#roadmap" class="mobile-nav-link hover:text-gold-accent transition duration-300">Roadmap</a>
            <a href="#contact" class="mobile-nav-link hover:text-gold-accent transition duration-300">Contact</a>
        </div>
    </div>

    <!-- Parallax Hero Banner -->
    <section id="home" class="relative h-screen w-full bg-charcoal flex items-center justify-center overflow-hidden">
        <!-- Continuous Radial Glow -->
        <div class="absolute inset-0 flex items-center justify-center z-10 pointer-events-none">
            <div class="w-3/4 h-3/4 rounded-full bg-gold-accent/5 blur-3xl opacity-50 animate-pulse-slow"></div>
        </div>

        <!-- Mughal Arch/Dome Motif (Light Ray/Atmospheric Lighting) -->
        <div id="hero-bg-parallax" class="absolute inset-0 z-10 opacity-70" style="background-image: radial-gradient(ellipse at 50% 10%, rgba(255, 215, 0, 0.15), transparent 80%);">
            <div class="absolute w-full h-full" style="clip-path: polygon(0 0, 100% 0, 100% 80%, 50% 100%, 0 80%); background-color: rgba(210, 180, 140, 0.05); transform: scale(1.5) rotate(-5deg); transition: transform 1s ease-out;"></div>
        </div>

        <div id="hero-text-parallax" class="relative z-20 text-center text-ivory p-8">
            <h1 class="text-5xl sm:text-7xl md:text-8xl lg:text-9xl font-display font-thin mb-4 overflow-hidden">
                <span class="inline-block animate-fadeInUp delay-300">Fiza</span>
                <span class="inline-block ml-4 animate-fadeInUp delay-500">Ali</span>
            </h1>
            <p class="text-xl sm:text-2xl md:text-3xl font-body uppercase tracking-[0.5em] opacity-0 animate-fadeInUp delay-800">
                The Architectural Custodian
            </p>
            <div class="mt-16 animate-pulse">
                <a href="#projects" class="nav-link text-sandstone border-b border-sandstone pb-1 text-lg hover:text-gold-accent transition duration-300">
                    Explore The Legacy
                </a>
            </div>
        </div>
    </section>

    <!-- --- SECTIONS START --- -->

    <!-- About Section -->
    <section id="about" class="relative py-24 md:py-32 px-6 sm:px-10 lg:px-20 bg-charcoal text-ivory overflow-hidden">
        <div class="max-w-7xl mx-auto z-10 relative">
            <div class="scroll-reveal">
                <h2 class="text-4xl md:text-6xl font-display font-light mb-16 text-center text-sandstone border-b border-sandstone/20 pb-4">
                    The Architect's Vision
                </h2>
            </div>
            <div class="grid md:grid-cols-2 gap-12 items-center">
                <div class="scroll-reveal">
                    <div class="relative aspect-[3/4] overflow-hidden rounded-xl shadow-2xl">
                        <img
                            src="https://placehold.co/800x1000/1F1F1F/F7F3E8?text=Zahra+Ali+Portrait"
                            alt="Architect Zahra Ali"
                            class="w-full h-full object-cover transition-all duration-1000 transform hover:scale-105"
                            onerror="this.onerror=null; this.src='https://placehold.co/800x1000/1F1F1F/F7F3E8?text=Zahra+Ali+Portrait';"
                        />
                    </div>
                </div>
                <div class="scroll-reveal">
                    <div class="space-y-6 text-lg">
                        <p class="text-sandstone font-display text-3xl">A Custodian of Heritage, A Sculptor of Tomorrow.</p>
                        <p class="text-ivory/80">
                            Zahra Ali's practice is a dialogue between the monumental legacy of the Mughal Empire and the imperative for sustainable, future-proof design. Every structure is approached not just as a building, but as a timeless artifact, merging the poetic symmetry of *jalis* and arches with modern computational design techniques.
                        </p>
                        <p class="text-ivory/80">
                            With a commitment to environmental harmony, the firm prioritizes natural light, passive cooling systems inspired by historical ventilation methods, and locally sourced materials, ensuring each project contributes meaningfully to its ecological and cultural landscape.
                        </p>
                        <p class="text-emerald font-semibold">
                            *The future is built on the foundations of the past.*
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Project Showcase -->
    <section id="projects" class="relative py-24 md:py-32 px-6 sm:px-10 lg:px-20 bg-charcoal text-ivory overflow-hidden">
        <div class="max-w-7xl mx-auto z-10 relative">
            <div class="scroll-reveal">
                <h2 class="text-4xl md:text-6xl font-display font-light mb-16 text-center text-sandstone border-b border-sandstone/20 pb-4">
                    Cinematic Project Showcase
                </h2>
            </div>
            <div id="project-filter" class="flex justify-center mb-12 space-x-4">
                <!-- Filter buttons rendered by JS -->
            </div>

            <div id="project-list" class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Project cards rendered by JS -->
            </div>
        </div>
    </section>

    <!-- Project Roadmap (Enhanced Infographics with Animated Line) -->
    <!-- Switched to Lighter, Subtle Colors -->
    <section id="roadmap" class="relative py-24 md:py-32 px-6 sm:px-10 lg:px-20 bg-ivory text-charcoal overflow-hidden">
        <div class="max-w-7xl mx-auto z-10 relative">
            <div class="scroll-reveal">
                <h2 class="text-4xl md:text-6xl font-display font-light mb-16 text-center text-charcoal/70 border-b border-charcoal/20 pb-4">
                    End-to-End Service Roadmap
                </h2>
            </div>
            <div class="text-center space-y-8 mb-16 scroll-reveal">
                <p class="max-w-4xl mx-auto text-xl text-charcoal/90">
                    Our comprehensive service model ensures design fidelity from the initial concept to post-occupancy handover. Each phase is a carefully curated step in the creation of your architectural legacy.
                </p>
            </div>
            <div id="roadmap-timeline" class="relative pt-12">
                
                <!-- Animated Line - This line grows as the user scrolls, creating the leading animation -->
                <!-- The line now uses a charcoal color on the ivory background -->
                <div id="animated-line" class="absolute left-1/2 -ml-0.5 top-0 w-1 bg-sandstone transform origin-top hidden md:block" style="height: 0px; opacity: 0; z-index: 5;"></div>
                
                <!-- Roadmap steps rendered by JS -->
                <div id="roadmap-steps" class="space-y-24"></div>
            </div>
        </div>
    </section>


    <!-- Awards & Testimonials Section -->
    <section id="awards-testimonials" class="relative py-24 md:py-32 px-6 sm:px-10 lg:px-20 bg-charcoal text-ivory overflow-hidden">
        <div class="max-w-7xl mx-auto z-10 relative">
            <div class="scroll-reveal">
                <h2 class="text-4xl md:text-6xl font-display font-light mb-16 text-center text-sandstone border-b border-sandstone/20 pb-4">
                    Recognition & Voice
                </h2>
            </div>
            <!-- Awards/Motion Counters -->
            <div id="counters-container" class="grid md:grid-cols-3 gap-8 mb-20 text-center">
                <!-- Counter Card 1 (Subtle Colors) -->
                <div class="scroll-reveal counter-card p-8 bg-ivory/5 rounded-xl border border-ivory/10 shadow-lg">
                    <i data-lucide="award" class="w-12 h-12 text-emerald/50 mx-auto mb-4"></i>
                    <span class="animated-counter text-8xl font-display font-extralight text-sandstone" data-target="3">0</span>
                    <p class="text-ivory/70 text-xl mt-2">Major Awards</p>
                </div>
                <!-- Counter Card 2 (Subtle Colors) -->
                <div class="scroll-reveal counter-card p-8 bg-ivory/5 rounded-xl border border-ivory/10 shadow-lg">
                    <i data-lucide="shield" class="w-12 h-12 text-emerald/50 mx-auto mb-4"></i>
                    <span class="animated-counter text-8xl font-display font-extralight text-sandstone" data-target="25">0</span>
                    <p class="text-ivory/70 text-xl mt-2">Years of Practice</p>
                </div>
                <!-- Counter Card 3 (Subtle Colors) -->
                <div class="scroll-reveal counter-card p-8 bg-ivory/5 rounded-xl border border-ivory/10 shadow-lg">
                    <i data-lucide="users" class="w-12 h-12 text-emerald/50 mx-auto mb-4"></i>
                    <span class="animated-counter text-8xl font-display font-extralight text-sandstone" data-target="100">0</span>
                    <p class="text-ivory/70 text-xl mt-2">Projects Completed</p>
                </div>
            </div>

            <!-- Client Testimonials (Functional Slider) -->
            <div class="scroll-reveal">
                <h3 class="text-3xl font-display mb-8 text-center text-ivory">Client Testimonials</h3>
                <div id="testimonial-slider" class="relative overflow-hidden w-full max-w-4xl mx-auto">
                    <div id="slider-track" class="flex transition-transform duration-700 ease-in-out">
                        <!-- Slides rendered by JS -->
                    </div>

                    <!-- Navigation Buttons (Subtle Colors) -->
                    <button id="prev-btn" class="absolute top-1/2 left-0 transform -translate-y-1/2 p-3 bg-ivory/20 rounded-full text-sandstone hover:bg-ivory/40 transition-colors hidden md:block" aria-label="Previous Testimonial">
                        <i data-lucide="arrow-left" class="w-6 h-6"></i>
                    </button>
                    <button id="next-btn" class="absolute top-1/2 right-0 transform -translate-y-1/2 p-3 bg-ivory/20 rounded-full text-sandstone hover:bg-ivory/40 transition-colors hidden md:block" aria-label="Next Testimonial">
                        <i data-lucide="arrow-right" class="w-6 h-6"></i>
                    </button>

                    <!-- Pagination Dots -->
                    <div id="pagination-dots" class="flex justify-center space-x-2 mt-4">
                        <!-- Dots rendered by JS -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="relative py-24 md:py-32 px-6 sm:px-10 lg:px-20 bg-charcoal text-ivory overflow-hidden">
        <div class="max-w-7xl mx-auto z-10 relative">
            <div class="scroll-reveal">
                <h2 class="text-4xl md:text-6xl font-display font-light mb-16 text-center text-sandstone border-b border-sandstone/20 pb-4">
                    Connect & Commission
                </h2>
            </div>
            <div class="grid md:grid-cols-2 gap-12">
                
                <!-- Animated Visiting Card -->
                <div class="scroll-reveal flex items-center justify-center">
                    <div id="visiting-card" 
                         class="relative w-full max-w-sm h-72 rounded-xl p-8 bg-gradient-to-br from-sandstone to-sandstone/70 text-charcoal shadow-2xl overflow-hidden cursor-pointer transition-all duration-700 transform hover:scale-[1.03] hover:shadow-gold-xl active:scale-95"
                         title="Click to copy details">
                        
                        <!-- Subtle Animated Pattern Background -->
                        <div class="absolute inset-0 opacity-10 pointer-events-none" style="background-image: radial-gradient(circle at 100% 100%, #1F1F1F 10%, transparent 50%);"></div>
                        
                        <!-- Card Content - Front -->
                        <div id="card-front" class="relative z-10 space-y-4">
                            <div class="flex items-center space-x-3 border-b border-charcoal/30 pb-3">
                                <i data-lucide="archive" class="w-8 h-8 text-charcoal"></i>
                                <h3 class="text-3xl font-display font-bold">Zahra Ali</h3>
                            </div>
                            
                            <p class="text-lg font-body uppercase tracking-wider">Architectural Custodian</p>
                            
                            <div class="pt-4 space-y-2">
                                <p class="flex items-center text-sm"><i data-lucide="mail" class="w-4 h-4 mr-2"></i> zahra@thecustodian.com</p>
                                <p class="flex items-center text-sm"><i data-lucide="phone" class="w-4 h-4 mr-2"></i> +971 50 123 4567</p>
                                <p class="flex items-center text-sm"><i data-lucide="map-pin" class="w-4 h-4 mr-2"></i> Dubai Design District (D3)</p>
                            </div>
                        </div>

                        <!-- Footer Accent -->
                        <p class="absolute bottom-4 right-4 text-charcoal/50 text-xs font-mono">EST. MMXXIV</p>
                        
                        <!-- Click Hint -->
                        <div class="absolute top-4 left-4 flex items-center text-sm font-semibold text-charcoal/80">
                            <i data-lucide="copy" class="w-4 h-4 mr-2"></i> Click to Copy
                        </div>
                    </div>
                </div>

                <!-- Success/Error Message Box -->
                <div id="message-box" class="mt-4 p-4 rounded-lg hidden"></div>

                <!-- Location Map Placeholder -->
                <div class="scroll-reveal">
                    <div class="relative h-full min-h-[300px] rounded-xl overflow-hidden shadow-2xl bg-royal-blue/30 flex flex-col items-center justify-center p-8 text-center">
                        <i data-lucide="map-pin" class="w-16 h-16 text-royal-blue/80 animate-pulse mb-4"></i>
                        <h4 class="text-2xl font-display text-ivory">Global Headquarters</h4>
                        <p class="text-sandstone text-lg">Dubai Design District (D3)</p>
                        <p class="text-sm mt-4 text-ivory/70">
                            (This space typically holds an interactive map or detailed contact information.)
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-12 px-6 sm:px-10 lg:px-20 bg-charcoal border-t border-sandstone/10 text-ivory/50 text-center text-xs relative z-20">
        <p>&copy; 2024 The Custodian. Architectural Poetry in Motion.</p>
        <p class="mt-2 text-sandstone">Inspired by Mughal Aesthetics.</p>
        <!-- User ID placeholder for Firebase requirement -->
        <p class="mt-4 text-[10px] opacity-20">User ID: <span id="user-id-display">Not Authenticated</span></p>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script type="module">
        // --- FIREBASE IMPORTS (MANDATORY BOILERPLATE) ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, addDoc, collection, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        let db, auth, userId = null;
        let isAuthReady = false;

        // Set Firebase logging level to Debug for visibility
        setLogLevel('Debug');

        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // --- DATA STUB ---
        const PROJECTS = [
            { id: 1, title: "The Jali Citadel", tagline: "Residential Luxury", category: "Residential", year: 2024, imageUrl: "https://placehold.co/800x600/1F1F1F/FFD700?text=Jali+Citadel" },
            { id: 2, title: "Emerald Museum", tagline: "Cultural Preservation", category: "Cultural", year: 2023, imageUrl: "https://placehold.co/800x600/004D40/F7F3E8?text=Emerald+Museum" },
            { id: 3, title: "The Royal Gateway", tagline: "Commercial Hub", category: "Commercial", year: 2022, imageUrl: "https://placehold.co/800x600/1A237E/DDB892?text=Royal+Gateway" },
            { id: 4, title: "Sandstone Villa", tagline: "Heritage Restoration", category: "Restoration", year: 2021, imageUrl: "https://placehold.co/800x600/DDB892/1F1F1F?text=Sandstone+Villa" },
        ];

        const TESTIMONIALS = [
            { name: "A. Khan", quote: "A seamless blend of tradition and future. Truly architectural poetry.", city: "Dubai" },
            { name: "Dr. S. Verma", quote: "The attention to detail and craftsmanship is unparalleled. Timeless design.", city: "London" },
            { name: "P. Mehta", quote: "Our project felt like a collaborative journey into modern sustainability.", city: "Mumbai" },
            { name: "L. Singh", quote: "The Custodian delivered beyond expectationâ€”a modern marvel rooted in deep heritage.", city: "New York" },
        ];

        const ROADMAP_STEPS = [
            { id: 1, title: "Inception & Vision", icon: 'compass', iconColor: 'text-sandstone', description: "Deep dive into cultural context, sustainability goals, and client aspirations to define the project's 'Soul'. Focus on feasibility and initial concept sketches." },
            { id: 2, title: "Mughal Geometry Design", icon: 'layers', iconColor: 'text-royal-blue', description: "Translating classical symmetry and *jalis* into modern computational models for optimal light, structure, and climate performance. Creation of detailed schematics." },
            { id: 3, title: "Kinetic Development", icon: 'zap', iconColor: 'text-gold-accent', description: "Detailed plan and integration of smart, passive climate control systems, kinetic structural elements, and advanced material specifications. Full technical documentation." },
            { id: 4, title: "Curation & Oversight", icon: 'calendar', iconColor: 'text-emerald', description: "Master artisan selection, rigorous material curation, and strict construction phase adherence to design integrity and quality control. Weekly site audits." },
            { id: 5, title: "Legacy & Maintenance", icon: 'home', iconColor: 'text-sandstone', description: "Post-occupancy evaluation, digital twin handover, and ongoing consultation for seamless heritage continuity, energy optimization, and final documentation." },
        ];


        // --- UTILITY FUNCTIONS ---

        /**
         * Displays a custom message box instead of alert().
         * @param {string} message 
         * @param {string} type 
         */
        const showMessage = (message, type) => {
            const box = document.getElementById('message-box');
            if (!box) return;

            box.textContent = message;
            box.classList.remove('hidden', 'bg-red-500/20', 'text-red-300', 'bg-green-500/20', 'text-green-300');
            
            if (type === 'success') {
                box.classList.add('bg-green-500/20', 'text-green-300');
            } else if (type === 'error') {
                box.classList.add('bg-red-500/20', 'text-red-300');
            }
            
            setTimeout(() => {
                box.classList.add('hidden');
            }, 5000);
        };

        /**
         * Smooth scrolls to an element by its ID.
         * IMPORTANT FIX: This function must be globally accessible (window.smoothScroll)
         * to be called directly from inline onclick attributes in the HTML/Modal.
         * @param {string} id 
         */
        window.smoothScroll = (id) => {
            const element = document.getElementById(id);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth' });
            }
        };

        /**
         * Global function to handle all navigation clicks.
         * @param {Event} e 
         */
        const handleNavClick = (e) => {
            e.preventDefault();
            const targetId = e.currentTarget.getAttribute('href').substring(1);
            window.smoothScroll(targetId);
            // Close mobile menu if open
            if (document.body.classList.contains('menu-open')) {
                toggleMobileMenu();
            }
        };

        const toggleMobileMenu = () => {
            const menu = document.getElementById('mobile-menu');
            const menuOpenIcon = document.getElementById('menu-icon-open');
            const menuCloseIcon = document.getElementById('menu-icon-close');

            const isOpen = menu.classList.contains('translate-x-full'); // Check current state
            
            // Toggle visibility classes
            menu.classList.toggle('translate-x-full');
            menu.classList.toggle('translate-x-0');

            if (isOpen) {
                menuOpenIcon.classList.remove('hidden');
                menuCloseIcon.classList.add('hidden');
                document.body.classList.remove('menu-open');
            } else {
                menuOpenIcon.classList.add('hidden');
                menuCloseIcon.classList.remove('hidden');
                document.body.classList.add('menu-open');
            }
        };

        // --- FIREBASE INITIALIZATION AND AUTH ---
        const initializeFirebase = async () => {
            if (!firebaseConfig) {
                console.error("Firebase config is missing.");
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('user-id-display').textContent = userId;
                        console.log("Firebase Auth Ready. User ID:", userId);
                    } else {
                        // Attempt anonymous sign-in if not authenticated
                        userId = crypto.randomUUID(); // Fallback for unauthenticated users
                        document.getElementById('user-id-display').textContent = 'ANON-' + userId.substring(0, 8);
                        console.log("Anonymous sign-in attempted.");
                    }
                    isAuthReady = true;
                });

                // Authenticate using the provided custom token or anonymously
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

            } catch (error) {
                console.error("Firebase initialization or sign-in failed:", error.message);
            }
        };

        // --- SCROLL EFFECTS ---

        const applyScrollEffects = () => {
            const header = document.getElementById('main-header');
            const heroText = document.getElementById('hero-text-parallax');
            const heroBg = document.getElementById('hero-bg-parallax');
            const scrollY = window.scrollY;

            // 1. Header Visibility
            if (scrollY > 80) {
                header.classList.add('header-scrolled');
            } else {
                header.classList.remove('header-scrolled');
            }

            // 2. Parallax Effect
            const parallaxTextY = scrollY * 0.4;
            const parallaxBgY = scrollY * 0.1;

            if (heroText) {
                heroText.style.transform = `translateY(-${parallaxTextY}px)`;
            }
            if (heroBg) {
                heroBg.style.transform = `translateY(${parallaxBgY}px)`;
            }

            // 3. Scroll Reveal Effect & Roadmap Line Animation
            const revealElements = document.querySelectorAll('.scroll-reveal');
            revealElements.forEach(el => {
                const rect = el.getBoundingClientRect();
                // Reveal when 150px from the bottom of the viewport
                if (rect.top < window.innerHeight - 150) { 
                    el.classList.add('visible');
                }
            });

            // FIX: 4. Counter Animation Trigger
            const countersContainer = document.getElementById('counters-container');
            if (countersContainer) {
                const rect = countersContainer.getBoundingClientRect();
                // Start animation when the container enters the viewport
                if (rect.top < window.innerHeight && rect.bottom > 0) {
                    animateCounters();
                }
            }
            
            // 5. Roadmap Animated Line Logic
            const roadmapSection = document.getElementById('roadmap-timeline');
            const animatedLine = document.getElementById('animated-line');

            if (roadmapSection && animatedLine && window.innerWidth >= 768) { 
                const sectionRect = roadmapSection.getBoundingClientRect();
                const timelineContainerHeight = roadmapSection.offsetHeight;
                const timelineStartOffset = 100; // Line starts below the top padding/title
                
                const distanceToViewportBottom = sectionRect.top - window.innerHeight + timelineStartOffset;
                
                let drawRatio = 0;

                if (distanceToViewportBottom < 0) {
                    const scrollProgress = -distanceToViewportBottom; 
                    const effectiveHeight = timelineContainerHeight - timelineStartOffset;
                    
                    drawRatio = Math.min(1, Math.max(0, scrollProgress / effectiveHeight));
                    
                    const lineLength = effectiveHeight * drawRatio;
                    
                    animatedLine.style.height = `${lineLength}px`;
                    animatedLine.style.opacity = '1';

                } else {
                    animatedLine.style.height = '0px';
                    animatedLine.style.opacity = '0';
                }
                
                animatedLine.style.top = `${timelineStartOffset}px`;
            }

        };


        // --- COMPONENT LOGIC IMPLEMENTATION ---

        // 1. Project List Rendering and Filtering
        let currentFilter = 'All';

        const renderProjects = () => {
            const projectList = document.getElementById('project-list');
            if (!projectList) return;

            const filteredProjects = PROJECTS.filter(p => currentFilter === 'All' || p.category === currentFilter);
            projectList.innerHTML = ''; // Clear existing projects

            filteredProjects.forEach(p => {
                // Attach window.openProjectModal() with the project ID on click
                const cardHtml = `
                    <div onclick="window.openProjectModal(${p.id})" class="scroll-reveal group relative overflow-hidden rounded-lg shadow-xl cursor-pointer aspect-[4/3] transform transition-all duration-500 ease-out hover:scale-[1.03] active:scale-[0.98]">
                        
                        <!-- Image/Placeholder with transition -->
                        <img
                            src="${p.imageUrl}"
                            alt="${p.title}"
                            class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105 group-hover:blur-sm"
                            onerror="this.onerror=null; this.src='https://placehold.co/800x600/1F1F1F/FFD700?text=Project';"
                        />

                        <!-- Overlay for details -->
                        <div class="overlay absolute inset-0 p-8 flex flex-col justify-end transition-all duration-500 ease-in-out bg-charcoal/40 group-hover:bg-charcoal/70">
                            <div class="transform transition-transform duration-500 translate-y-4 opacity-0 group-hover:translate-y-0 group-hover:opacity-100">
                                <p class="text-sandstone text-sm uppercase tracking-widest">${p.category} | ${p.year}</p>
                                <h3 class="text-2xl font-display text-ivory mt-1">${p.title}</h3>
                                <p class="text-ivory/70 text-sm mt-2">${p.tagline}</p>
                            </div>
                        </div>

                        <!-- Mughal Corner Ornament -->
                        <div class="absolute top-4 right-4 text-gold-accent/70 transition-opacity duration-300 opacity-50 group-hover:opacity-100">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class='transform rotate-90'>
                                <path d="M12 2v20M2 12h20M5 5l14 14M5 19l14-14M12 12m-6 0a6 6 0 1 0 12 0a6 6 0 1 0 -12 0" />
                            </svg>
                        </div>
                    </div>
                `;
                projectList.insertAdjacentHTML('beforeend', cardHtml);
            });
            initScrollReveal();
        };

        const renderFilterButtons = () => {
            const filterContainer = document.getElementById('project-filter');
            if (!filterContainer) return;

            const categories = ['All', ...new Set(PROJECTS.map(p => p.category))];
            filterContainer.innerHTML = categories.map(cat => `
                <button
                    onclick="window.handleFilter('${cat}')"
                    class="px-4 py-2 text-sm uppercase tracking-wider rounded-full transition-all duration-300 font-body
                        ${currentFilter === cat ? 'bg-sandstone text-charcoal shadow-gold-xl' : 'text-ivory border border-sandstone/30 hover:border-gold-accent hover:text-gold-accent'}"
                >
                    ${cat}
                </button>
            `).join('');
        };

        window.handleFilter = (filter) => {
            currentFilter = filter;
            renderFilterButtons();
            renderProjects();
        };

        // 2. Project Modal Logic
        const projectModal = document.getElementById('project-modal');
        const modalContent = document.getElementById('modal-content');

        window.openProjectModal = (projectId) => {
            const project = PROJECTS.find(p => p.id === projectId);
            if (!project) return;

            modalContent.innerHTML = `
                <div class="md:grid md:grid-cols-2 gap-6 p-4 md:p-8">
                    <div class="md:p-0 p-4">
                        <img src="${project.imageUrl}" alt="${project.title}" class="rounded-lg shadow-xl w-full h-auto mb-6" />
                        <p class="text-sm text-charcoal/50 uppercase tracking-widest">${project.category} | ${project.year}</p>
                        <h3 class="text-3xl font-display font-bold text-charcoal mb-2">${project.title}</h3>
                        <p class="text-xl font-body text-sandstone mb-4">${project.tagline}</p>
                        
                        <!-- Mock Detailed Description -->
                        <div class="space-y-4 text-charcoal/80 text-base">
                            <p>This project, *${project.title}*, embodies the fusion of Mughal architectural discipline with computational design efficiency. It was completed in ${project.year}, focusing heavily on ${project.category === 'Residential' ? 'passive cooling and maximizing natural light' : project.category === 'Cultural' ? 'structural longevity and authentic material sourcing' : 'integrated smart systems and public flow optimization'}.</p>
                            <p>The core challenge was to achieve the characteristic symmetry and detailing of the requested style while adhering to modern structural codes and sustainability metrics. The resulting structure serves as a benchmark for contemporary heritage-inspired architecture.</p>
                        </div>

                        <a href="#contact" onclick="window.closeProjectModal(); window.smoothScroll('contact');" class="mt-8 inline-flex items-center px-6 py-3 bg-emerald text-ivory rounded-full transition-colors hover:bg-emerald/80 shadow-md text-sm font-semibold">
                            <i data-lucide="handshake" class="w-4 h-4 mr-2"></i> Inquire About Commissions
                        </a>
                    </div>
                    
                    <!-- Contextual Graphics / Details Pane -->
                    <div class="hidden md:block bg-charcoal/5 p-6 rounded-r-xl">
                        <h4 class="text-xl font-display mb-4 text-charcoal/80">Key Metrics</h4>
                        <ul class="space-y-3 text-charcoal/70">
                            <li class="flex justify-between border-b border-charcoal/10 pb-2"><span>Status:</span> <span class="font-semibold text-emerald">Completed</span></li>
                            <li class="flex justify-between border-b border-charcoal/10 pb-2"><span>Area:</span> <span class="font-semibold">3,500 sq. m</span></li>
                            <li class="flex justify-between border-b border-charcoal/10 pb-2"><span>Design Lead:</span> <span class="font-semibold">Zahra Ali</span></li>
                            <li class="flex justify-between border-b border-charcoal/10 pb-2"><span>Style:</span> <span class="font-semibold">Mughal Futurism</span></li>
                        </ul>
                        
                        <h4 class="text-xl font-display mt-8 mb-4 text-charcoal/80">Cultural Impact</h4>
                        <p class="text-sm italic text-charcoal/60">"It stands as a testament to how deep cultural roots can inform radical modern structures, providing inspiration for the next generation of architects."</p>
                    </div>
                </div>
            `;
            lucide.createIcons(); 
            
            // Show modal with transition
            projectModal.classList.remove('opacity-0', 'pointer-events-none');
            modalContent.classList.remove('scale-95');
            document.body.style.overflow = 'hidden'; // Prevent scrolling background

            // Add event listener for outside click to close
            document.addEventListener('click', handleModalOutsideClick);
        };

        window.closeProjectModal = () => {
            // Hide modal with transition
            projectModal.classList.add('opacity-0', 'pointer-events-none');
            modalContent.classList.add('scale-95');
            document.body.style.overflow = ''; // Re-enable background scrolling
            document.removeEventListener('click', handleModalOutsideClick);
        };

        const handleModalOutsideClick = (e) => {
            // Only close if the click target is the modal backdrop itself
            if (e.target === projectModal) {
                window.closeProjectModal();
            }
        };


        // 3. Testimonial Slider Logic
        let activeIndex = 0;
        let slideInterval = null;

        const renderTestimonials = () => {
            const sliderTrack = document.getElementById('slider-track');
            const paginationDots = document.getElementById('pagination-dots');
            if (!sliderTrack || !paginationDots) return;

            // Render Slides (Note: Updated slide colors in CSS/HTML structure are applied here)
            sliderTrack.innerHTML = TESTIMONIALS.map((t, index) => `
                <div data-index="${index}" class="flex-shrink-0 w-full p-6 md:p-10 text-center rounded-xl bg-ivory/90 shadow-xl min-h-64">
                    <i data-lucide="quote" class="w-10 h-10 text-sandstone/80 mx-auto mb-4"></i>
                    <p class="text-xl md:text-2xl font-display text-charcoal italic mb-6">"${t.quote}"</p>
                    <p class="text-lg font-semibold text-emerald/70">- ${t.name}</p>
                    <p class="text-sm text-charcoal/50">${t.city}</p>
                </div>
            `).join('');

            // Render Dots
            paginationDots.innerHTML = TESTIMONIALS.map((t, index) => `
                <button data-index="${index}" onclick="window.goToSlide(${index})" class="dot w-3 h-3 rounded-full transition-colors duration-300 ${index === activeIndex ? 'bg-sandstone' : 'bg-charcoal/20 hover:bg-charcoal/40'}" aria-label="Go to slide ${index + 1}"></button>
            `).join('');
            
            updateSliderPosition();
        };

        const updateSliderPosition = () => {
            const sliderTrack = document.getElementById('slider-track');
            if (!sliderTrack) return;

            const slideWidth = sliderTrack.clientWidth;
            sliderTrack.style.transform = `translateX(-${activeIndex * slideWidth}px)`;

            // Update dots
            document.querySelectorAll('#pagination-dots .dot').forEach((dot, index) => {
                dot.classList.remove('bg-sandstone');
                dot.classList.add('bg-charcoal/20', 'hover:bg-charcoal/40');
                if (index === activeIndex) {
                    dot.classList.add('bg-sandstone');
                    dot.classList.remove('bg-charcoal/20', 'hover:bg-charcoal/40');
                }
            });
        };

        const goToSlide = (index) => {
            if (index >= 0 && index < TESTIMONIALS.length) {
                activeIndex = index;
                updateSliderPosition();
                resetInterval();
            }
        };

        const nextSlide = () => goToSlide((activeIndex + 1) % TESTIMONIALS.length);
        const prevSlide = () => goToSlide((activeIndex - 1 + TESTIMONIALS.length) % TESTIMONIALS.length);

        const resetInterval = () => {
            clearInterval(slideInterval);
            slideInterval = setInterval(nextSlide, 8000); // Auto-advance every 8 seconds
        };

        // Attach slider controls to global scope
        window.goToSlide = goToSlide;
        // Attach next/prev to global scope for buttons
        document.getElementById('prev-btn')?.addEventListener('click', prevSlide);
        document.getElementById('next-btn')?.addEventListener('click', nextSlide);


        // 4. Roadmap Rendering (UPDATED for light background)
        const renderRoadmap = () => {
            const stepsContainer = document.getElementById('roadmap-steps');
            if (!stepsContainer) return;

            stepsContainer.innerHTML = ROADMAP_STEPS.map((step, index) => {
                const isOdd = index % 2 !== 0;
                // Align content right on even indices (0, 2, 4...) and left on odd indices (1, 3, 5...)
                const alignment = isOdd ? 'md:justify-start' : 'md:justify-end';
                const contentAlign = isOdd ? 'md:text-left' : 'md:text-right';
                const ml = isOdd ? 'md:ml-20' : 'md:mr-20';
                
                return `
                    <div class="scroll-reveal flex flex-col ${alignment} items-center md:flex-row relative group roadmap-step" data-index="${index}">
                        
                        <!-- Timeline Dot (Infographic Element) - Desktop Only -->
                        <div class="absolute left-1/2 transform -translate-x-1/2 w-8 h-8 rounded-full ${step.iconColor.replace('text-', 'bg-')}/30 border-2 border-sandstone/30 z-10 hidden md:flex items-center justify-center transition-all duration-1000 ease-out p-1">
                            <div class="w-full h-full rounded-full bg-ivory flex items-center justify-center">
                                <i data-lucide="${step.icon}" class="w-4 h-4 ${step.iconColor} z-20"></i>
                            </div>
                        </div>
                        
                        <!-- Mobile Dot/Separator -->
                        <div class="md:hidden w-3 h-3 rounded-full bg-sandstone/80 mb-6 mt-2"></div>

                        <!-- Content Card (Subtle Color, Shadow, and Hover effect) -->
                        <div class="roadmap-step-card w-full md:w-5/12 p-8 rounded-2xl bg-white shadow-xl backdrop-blur-sm ${ml} transform transition-all duration-700 hover:shadow-lg hover:bg-white/95 text-center ${contentAlign}">
                            <h3 class="text-2xl font-display font-bold mb-3 ${step.iconColor}">${step.title}</h3>
                            <p class="text-charcoal/70">${step.description}</p>
                            <!-- Visual accent for the card -->
                            <div class="absolute inset-0 rounded-2xl ring-4 ring-inset ${step.iconColor.replace('text-', 'ring-')}/10 pointer-events-none"></div>
                        </div>
                    </div>
                `;
            }).join('');
            // Ensure icons are rendered after the HTML update
            lucide.createIcons(); 
            initScrollReveal();
        };

        // 5. Animated Counter Logic (Now triggered by applyScrollEffects)
        const animateCounters = () => {
            const counters = document.querySelectorAll('.animated-counter');
            counters.forEach(counter => {
                // Prevent re-animation
                if (counter.classList.contains('animated')) return;
                counter.classList.add('animated');

                const target = parseInt(counter.dataset.target, 10);
                let current = 0;
                const duration = 2000;
                const stepTime = Math.abs(Math.floor(duration / target));

                const updateCount = () => {
                    if (current < target) {
                        // Increase step size for smoother/faster animation on large numbers
                        const step = Math.ceil((target - current) / 20); 
                        current += step;
                        if (current > target) current = target; // Clamp to target
                        counter.textContent = current;
                        setTimeout(updateCount, 50); // Fixed interval for smoothness
                    } else {
                        counter.textContent = target; // Ensure it stops exactly on the target
                    }
                };
                updateCount();
            });
        };

        // 6. Visiting Card Interaction Logic
        const setupVisitingCard = () => {
            const card = document.getElementById('visiting-card');
            if (!card) return;

            card.addEventListener('click', () => {
                const contactDetails = `Zahra Ali | Architectural Custodian\nEmail: zahra@thecustodian.com\nPhone: +971 50 123 4567\nLocation: Dubai Design District (D3)`;
                
                // Use document.execCommand('copy') as navigator.clipboard.writeText() is restricted in iframes
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = contactDetails;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                try {
                    document.execCommand('copy');
                    showMessage('Details copied to clipboard!', 'success');
                } catch (err) {
                    showMessage('Failed to copy details. Please manually copy them.', 'error');
                }
                document.body.removeChild(tempTextArea);
            });
        };
        
        // 7. Init Scroll Reveal
        const initScrollReveal = () => {
            // Apply a small timeout to ensure elements are rendered before calculating positions
            setTimeout(() => {
                applyScrollEffects(); // Initial check on load
            }, 100);
        };


        // --- APPLICATION LIFECYCLE ---

        document.addEventListener('DOMContentLoaded', () => {
            initializeFirebase(); // Setup Firebase Auth
            
            // Render components
            renderFilterButtons();
            renderProjects();
            renderTestimonials();
            renderRoadmap();

            // Set up event listeners
            document.querySelectorAll('.nav-link, .mobile-nav-link').forEach(link => {
                link.addEventListener('click', handleNavClick);
            });
            document.getElementById('menu-toggle').addEventListener('click', toggleMobileMenu);
            document.getElementById('close-modal-btn')?.addEventListener('click', window.closeProjectModal);


            window.addEventListener('scroll', applyScrollEffects);
            window.addEventListener('resize', () => {
                // Re-calculate slider position on resize
                updateSliderPosition();
                applyScrollEffects(); // Recalculate roadmap line on resize
            });

            // Initial setup for icons, counters, and slider
            lucide.createIcons();
            setupVisitingCard();
            
            // Start components
            resetInterval();
            initScrollReveal();
        });

    </script>
</body>
</html>
